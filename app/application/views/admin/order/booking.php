<?php
//$data = '{"diagnostic":{"status":200,"elapsetime":"0.1442","memoryusage":"8.88MB","unix_timestamp":1503390899,"confirm":"success","lang":"id","currency":"IDR"},"output_type":"json","myorder":{"order_id":"36767883","data":[{"expire":-15,"uri":"lion","order_detail_id":"52075404","order_expire_datetime":"2017-08-22 14:52:02","order_type":"flight","customer_price":"480000.00","order_name":"SUB (Surabaya) - CGK (Jakarta - Cengkareng)","order_name_detail":"Lion (JT-571 - Depart)","order_detail_status":"recheck","detail":{"order_detail_id":"52075404","airlines_name":"Lion","flight_number":"JT-571","trip":"trip","price_adult":"480000.00","price_child":"0.00","price_infant":"0.00","flight_date":"23 Agu 2017","departure_time":"06:45","arrival_time":"08:15","baggage_fee":"0","departure_airport_name":"Juanda","arrival_airport_name":"Soekarno Hatta","passengers":{"adult":[{"order_passenger_id":"22976875","order_detail_id":"52075404","type":"adult","first_name":"uqhy","last_name":"kecret","title":"Mr","id_number":"","birth_date":null,"adult_index":null,"passport_no":null,"passport_expiry":null,"passport_issuing_country":null,"passport_nationality":null,"check_in_baggage":"20","check_in_baggage_return":null,"check_in_baggage_size":"20","check_in_baggage_size_return":null,"passport_issued_date":null,"birth_country":null,"ticket_number":null,"check_in_baggage_unit":"kg"}]},"real_flight_date":"2017-08-23","price":480000,"breakdown_price":[{"category":"price adult","type":"none","value":480000,"currency":"IDR","text":"Harga Dewasa"},{"category":"total base price","type":"price","value":480000,"currency":"IDR","text":"Harga Total"},{"category":"baggage fee","type":"add","value":"0","currency":"IDR","text":"Biaya Bagasi"}],"departure_city":"SUB","arrival_city":"CGK"},"order_photo":"https:\/\/api.tiket.com\/images\/icon_lion.jpg","order_icon":"h3b","tax_and_charge":"10107.52","subtotal_and_charge":"490107.52","delete_uri":"https:\/\/api.tiket.com\/order\/delete_order?order_detail_id=52075404","business_id":"20864"},{"expire":37,"uri":"lion","order_detail_id":"52080048","order_expire_datetime":"2017-08-22 16:12:09","order_type":"flight","customer_price":"1449400.00","order_name":"SUB (Surabaya) - DPS (Denpasar, Bali)","order_name_detail":"Lion (JT-804 - Depart)","order_detail_status":"active","detail":{"order_detail_id":"52080048","airlines_name":"Lion","flight_number":"JT-804","trip":"trip","price_adult":"470133.00","price_child":"470133.00","price_infant":"39000.00","flight_date":"23 Agu 2017","departure_time":"05:45","arrival_time":"07:40","baggage_fee":"0","departure_airport_name":"Juanda","arrival_airport_name":"Ngurah Rai","passengers":{"adult":[{"order_passenger_id":"22979257","order_detail_id":"52080048","type":"adult","first_name":"uqhy","last_name":"kecret","title":"Mr","id_number":"","birth_date":null,"adult_index":null,"passport_no":null,"passport_expiry":null,"passport_issuing_country":null,"passport_nationality":null,"check_in_baggage":"20","check_in_baggage_return":null,"check_in_baggage_size":"20","check_in_baggage_size_return":null,"passport_issued_date":null,"birth_country":null,"ticket_number":null,"check_in_baggage_unit":"kg"},{"order_passenger_id":"22979258","order_detail_id":"52080048","type":"adult","first_name":"anis","last_name":"kepet","title":"Mrs","id_number":"","birth_date":null,"adult_index":null,"passport_no":null,"passport_expiry":null,"passport_issuing_country":null,"passport_nationality":null,"check_in_baggage":"20","check_in_baggage_return":null,"check_in_baggage_size":"20","check_in_baggage_size_return":null,"passport_issued_date":null,"birth_country":null,"ticket_number":null,"check_in_baggage_unit":"kg"}],"child":[{"order_passenger_id":"22979259","order_detail_id":"52080048","type":"child","first_name":"rizky","last_name":"hakim","title":"Mstr","id_number":null,"birth_date":"2007-08-22","adult_index":null,"passport_no":null,"passport_expiry":null,"passport_issuing_country":null,"passport_nationality":null,"check_in_baggage":"20","check_in_baggage_return":null,"check_in_baggage_size":"20","check_in_baggage_size_return":null,"passport_issued_date":null,"birth_country":null,"ticket_number":null,"check_in_baggage_unit":"kg"}],"infant":[{"order_passenger_id":"22979260","order_detail_id":"52080048","type":"infant","first_name":"siti","last_name":"fatimah","title":"Miss","id_number":null,"birth_date":"2016-09-22","adult_index":"1","passport_no":null,"passport_expiry":null,"passport_issuing_country":null,"passport_nationality":null,"check_in_baggage":null,"check_in_baggage_return":null,"check_in_baggage_size":null,"check_in_baggage_size_return":null,"passport_issued_date":null,"birth_country":null,"ticket_number":null}]},"real_flight_date":"2017-08-23","price":1449400,"breakdown_price":[{"category":"price adult","type":"none","value":470133,"currency":"IDR","text":"Harga Dewasa"},{"category":"price child","type":"none","value":470133,"currency":"IDR","text":"Harga Anak"},{"category":"price infant","type":"none","value":39000,"currency":"IDR","text":"Harga Bayi"},{"category":"total base price","type":"price","value":1449399,"currency":"IDR","text":"Harga Total"},{"category":"baggage fee","type":"add","value":"0","currency":"IDR","text":"Biaya Bagasi"}],"departure_city":"SUB","arrival_city":"DPS"},"order_photo":"https:\/\/api.tiket.com\/images\/icon_lion.jpg","order_icon":"h3b","tax_and_charge":"30520.48","subtotal_and_charge":"1479920.48","delete_uri":"https:\/\/api.tiket.com\/order\/delete_order?order_detail_id=52080048","business_id":"20864"},{"expire":221,"order_detail_id":"52080331","order_expire_datetime":"2017-08-22 19:16:44","order_type":"hotel","order_name":"Gunawangsa Manyar Hotel Surabaya","order_name_detail":"Deluxe Room Only","order_detail_status":"active","tenor":"0","detail":{"order_detail_id":"52080331","room_id":"803267","rooms":"1","adult":"1","child":"0","startdate":"23 Agu 2017","enddate":"24 Agu 2017","nights":"1","total_charge":"0.00","startdate_original":"1503421200","enddate_original":"1503507600","price":318000,"price_per_night":318000,"compulsory_data":[]},"order_photo":"https:\/\/tiket.com\/img\/business\/d\/e\/business-deluxe-room-only-gunawangsamanyarhotelsurabaya-surabaya9219.s.jpg","tax":0,"item_charge":0,"subtotal_and_charge":"318000.00","delete_uri":"https:\/\/api.tiket.com\/order\/delete_order?order_detail_id=52080331","business_id":"19588103","is_expedia":0}],"total":2288028,"total_tax":40628,"total_without_tax":2247400,"count_installment":0,"promo":[],"discount":"Dapatkan potongan hingga IDR 40.628,00 saat anda checkout . Tidak berlaku untuk Kartu Kredit.","discount_amount":"40628.00"},"checkout":"https:\/\/api.tiket.com\/order\/checkout\/36767883\/IDR","login_status":"false","token":"af6f27051562217236274a898674e8f6dae1516e"}';
//$data = json_decode($data);
//echo json_encode($data);

if($isOrder == 1){
$diagnostic = $data->diagnostic;
$myorder	= $data->myorder;	

//echo json_encode($myorder);
?>

<div class="col-md-12 booking">
	<div class="row">
		<label>Order ID : <?php echo $myorder->order_id; ?></label>
	</div>
	<div class="row"><hr /></div>
	<div class="row">
		<table border="1">
		<?php foreach($myorder->data as $order){ 
				if($order->order_type == "flight"){
					$passengers = $order->detail->passengers;
					$cPassengersA = 0;$cPassengersC = 0;$cPassengersI = 0;
					if(isset($passengers->adult)){
						$cPassengersA = count($passengers->adult);
					}
					if(isset($passengers->child)){
						$cPassengersC = count($passengers->child);
					}
					if(isset($passengers->infant)){
						$cPassengersI = count($passengers->infant);
					}
		?>
					
					<tr>
						<td>
							<label>Airlines</label>
							<span>: <?php echo $order->order_name_detail; ?></span><br />
							<label>Flight</label>
							<span>: <?php echo $order->order_name; ?></span><br />
							<label>Passenger</label>
							<span>: <?php echo $cPassengersA; ?> Adult, </span><span><?php echo $cPassengersC; ?> Child, </span><span><?php echo $cPassengersI; ?> Infant</span><br />
							<label>Departure</label>
							<span>: <?php echo $order->detail->flight_date . ' ' . $order->detail->departure_time; ?></span><br />
							<label>Arrival</label>
							<span>: <?php echo $order->detail->flight_date . ' ' . $order->detail->arrival_time; ?></span><br />
						</td>
						<td>
							<label>Passengers : </label><br />
							<?php
							if(isset($passengers->adult)){
								echo '<span>Adult : </span><br />';
								$n = 0;
								foreach($passengers->adult as $adult){
									$n++;
									echo $n . '. ' . $adult->title . ' ' . $adult->first_name . ' ' . $adult->last_name . ' | ';
									echo '<b>Bagage : </b>' . $adult->check_in_baggage . ' Kg<br />';
								}
								echo '<br />';
							}
							if(isset($passengers->child)){
								echo '<span>Child : </span><br />';
								$n = 0;
								foreach($passengers->child as $child){
									$n++;
									echo $n . '. ' . $child->title . ' ' . $child->first_name . ' ' . $child->last_name . ' | ';
									echo '<b>Bagage : </b>' . $child->check_in_baggage . ' Kg<br />';
								}
								echo '<br />';
							}
							if(isset($passengers->infant)){
								echo '<span>Infant : </span><br />';
								$n = 0;
								foreach($passengers->infant as $infant){
									$n++;
									echo $n . '. ' . $infant->title . ' ' . $infant->first_name . ' ' . $infant->last_name;
								}
								echo '<br />';
							}
							?>
						</td>
						<td>
							<label>IDR&nbsp;&nbsp;&nbsp;<?php echo $order->customer_price; ?></label>
						</td>
						<td align="center">
							<label>Checkout</label><br />
							<span>Waiting Confirmation</span><br />
						</td>
					</tr>
					
		<?php	}else{?>
			
					<tr>
						<td>
							<label>Hotel</label>
							<span>: <?php echo $order->order_name; ?></span><br />
							<label>Room</label>
							<span>: <?php echo $order->order_name_detail; ?></span><br />
							<label><?php echo $order->detail->nights; ?> Nights, <?php echo $order->detail->rooms; ?> Rooms</label><br />
							<label>Start</label>
							<span>: <?php echo $order->detail->startdate; ?></span><br />
							<label>End</label>
							<span>: <?php echo $order->detail->enddate; ?></span><br />
						</td>
						<td></td>
						<td>
							<label>IDR&nbsp;&nbsp;&nbsp;<?php echo $order->subtotal_and_charge; ?></label>
						</td>
						<td align="center">
							<label>Checkout</label><br />
							<span>Waiting Confirmation</span><br />
						</td>
					</tr>
			
		<?php 	}
			} ?>
		</table>
		<br />
	</div>
</div>

<?php }
else{ 

$diagnostic = $data->diagnostic;
$myorder	= $data->result;	
 ?>


<div class="col-md-12 booking">
	<div class="row">
		<label>Order ID : <?php echo $myorder->order_id; ?></label><br />
		<label>Payment Status : <?php echo $myorder->payment_status; ?></label>
	</div>
	<div class="row"><hr /></div>
	<div class="row">
		<table border="1">
		<?php foreach($myorder->order__cart_detail as $order){ 
				if($order->order_type == "flight"){
					$passengers = $order->passanger;
					$cPassengersA = 0;$cPassengersC = 0;$cPassengersI = 0;
		?>
					
					<tr>
						<td>
							<label>Airlines</label>
							<span>: <?php echo $order->order_name_detail; ?></span><br />
							<label>Flight</label>
							<span>: <?php echo $order->order_name; ?></span><br />
							<label>Departure</label>
							<span>: <?php echo $order->detail->departure_time; ?></span><br />
							<label>Arrival</label>
							<span>: <?php echo $order->detail->arrival_time; ?></span><br />
						</td>
						<td>
							<label>Passengers : </label><br />
							<?php
							
							foreach($passengers as $p){
								if($p->passenger_age_group == "adult"){
									
									if($cPassengersA == 0){
										echo '<span>Adult : </span><br />';
									}
									$cPassengersA++;
									echo $cPassengersA . '. ' . $p->passenger_name . ' | ';
									echo '<b>Bagage : </b>' . $p->passanger_baggage . ' Kg<br />';
								}
								if($p->passenger_age_group == "child"){
									
									if($cPassengersC == 0){
										echo '<span>Child : </span><br />';
									}
									$cPassengersC++;
									echo $cPassengersC . '. ' . $p->passenger_name . ' | ';
									echo '<b>Bagage : </b>' . $p->passanger_baggage . ' Kg<br />';
								}
								if($p->passenger_age_group == "infant"){
									
									if($cPassengersI == 0){
										echo '<span>Infant : </span><br />';
									}
									$cPassengersI++;
									echo $cPassengersI . '. ' . $p->passenger_name;
								}
							}
							?>
							<br />
							<span>: <?php echo $cPassengersA; ?> Adult, </span><span><?php echo $cPassengersC; ?> Child, </span><span><?php echo $cPassengersI; ?> Infant</span><br />
						</td>
						<td>
							<label>IDR&nbsp;&nbsp;&nbsp;<?php echo $order->customer_price; ?></label>
						</td>
						<td align="center">
							<label>Ticket Status:  <?php echo $order->detail->ticket_status; ?></label><br />
							<span>Booking Code:  <?php echo $order->detail->booking_code; ?></span><br />
						</td>
					</tr>
					
		<?php	}else{?>
			
					<tr>
						<td>
							<label>Hotel</label>
							<span>: <?php echo $order->order_name; ?></span><br />
							<label>Room</label>
							<span>: <?php echo $order->order_name_detail; ?></span><br />
							<label><?php echo $order->detail->nights; ?> Nights, <?php echo $order->detail->rooms; ?> Rooms</label><br />
							<label>Check In</label>
							<span>: <?php echo $order->detail->checkin; ?></span><br />
						</td>
						<td></td>
						<td>
							<label>IDR&nbsp;&nbsp;&nbsp;<?php echo $order->customer_price; ?></label>
						</td>
						<td align="center">
							<label>Reservation Code:  <?php echo $order->detail->reservation_code; ?></label><br />
						</td>
					</tr>
			
		<?php 	}
			} ?>
		</table>
		<br />
	</div>
</div>


<?php } ?>
<style>
.booking table{
	width:100%;
	border:1px solid #ccc;
}
.booking table tr td{
	vertical-align:top;
	padding:12px;
}
.booking table tr td label{
	min-width:80px;
}
</style>
